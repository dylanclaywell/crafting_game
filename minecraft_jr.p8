pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _update()
	update_player()
end

function _draw()
	cls(3)
	map(0,0,0,0,16,16)
	draw_player()
end
-->8
player={
	cur_spr=1,
	x=1,
	y=1,
	menu_open=false,
	dir='left'
}

function draw_player()
	spr(player.cur_spr,player.x,player.y)
	if(player.menu_open) then end

	draw_menu()
end

function update_player()
 if(not(player.menu_open)) then
		if(btn(0)) then 
			player.x=player.x-1
			player.dir='left' 
		end
		if(btn(1)) then 
			player.x=player.x+1
			player.dir='right' 
		end
		if(btn(2)) then 
			player.y=player.y-1
			player.dir='up' 
		end
		if(btn(3)) then 
			player.y=player.y+1
			player.dir='down' 
		end
	
		if(btn(4)) then
		 punch(player.dir) 
		end
	
	 if(btnp(5)) then toggle_menu() end
	else
		if(btnp(5)) then toggle_menu() end
	end
	
	update_menu()
end

function toggle_menu()
	player.menu_open=not(player.menu_open)
	
	if(player.menu_open) then
		menu.is_opening=true
	else
		menu.is_closing=true
	end
end

function punch(dir)
	ptilex=player.x/8
	ptiley=player.y/8
	
	tilex=ptilex
	tiley=ptiley
	
	if(dir=='left') then
	 tilex=tilex-1
	elseif(dir=='right') then
		tilex=tilex+1
	elseif(dir=='up') then
		tiley=tiley-1
	elseif(dir=='down') then
		tiley=tiley+1
	end
	 
 tile=mget(tilex,tiley)
 
 if(tile and tile==tiledefs.tree) then
 	add_item_to_inv('wood',1)
 	mset(tilex,tiley,0)
 elseif(tile and tile==tiledefs.stone) then
 	add_item_to_inv('stone',1)
 	mset(tilex,tiley,0)
 end
end
-->8
menu={
	is_open=false,
	is_opening=false,
	x=10,
	y=10,
	height=0,
	max_height=40,
	width=50,
	open_speed=10,
	items={}
}

function draw_menu()
	if(menu.is_open or menu.is_opening) then
	 rectfill(menu.x,menu.y,menu.x+menu.width,menu.y+menu.height,1)
		rect(menu.x+1,menu.y+1,menu.x+menu.width-1,menu.y+menu.height-1,7)
		print('items',menu.x+3,menu.y+3)
	 line(menu.x+1,menu.y+9,menu.x+menu.width-1,menu.y+9,7)
	
		i=0
		for k,v in pairs(menu.items) do
			print(k,menu.x+3,menu.y+12+(7*i))
			print(v.amount,menu.x+menu.width-13,menu.y+12+(7*i))
			
			i=i+1
		end
	end
end

function update_menu()
 if(not(menu.is_open) and menu.is_opening) then
 	if(menu.height<menu.max_height) then
 	 menu.height=menu.height+menu.open_speed
 	else
 		menu.is_open=true
 		menu.is_opening=false
 	end
 elseif(menu.is_open and menu.is_closing) then
 	if(menu.height>0) then
 		menu.height=menu.height-menu.open_speed
 	else
 		menu.is_open=false
 		menu.is_closing=false
 	end
 end
end

function add_item_to_inv(name,amount)
	item=menu.items[name]
	
	if(item) then
		item.amount=item.amount+amount
	else
		menu.items[name]={
		 amount=amount
		}
	end
end
-->8
tiledefs={
	tree=32,
	stone=33
}
__gfx__
00000000011111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001f5f5100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070001ffff100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000018888100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000018888100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070001cccc100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001c11c100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000011001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
18788881144444410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
17777771114411110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
18887881144444410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
18887881111144410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
17777771144441110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
18788881144444410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00177100011111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01bbb710116771100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
13bbbbb1166677110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
133bbbb1155666610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
13333331115556510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11144111011155100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00011000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000002100200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002100200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
